{% load static %}
{% load group_tags %}

<nav class="navbar navbar-expand-lg navbar-light bg-primary-subtle mb-0">
  <div class="container-fluid">

    <!-- BRAND / LOGO -->
    <a class="navbar-brand" href="/">
      <img src="{% static 'images/logo.png' %}" style="height:60px; width:auto; margin-top:-5px;" alt="logo" />
      LFMS
    </a>

    <!-- MOBILE MENU BUTTON -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- NAV CONTENT -->
    <div class="collapse navbar-collapse" id="mainNav">

      <!-- LEFT SIDE MENU -->
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">

        {% if user.is_authenticated %}

          <!-- ================= ADMIN ================= -->
          {% if user|has_group:"Admin" %}
            <li class="nav-item"><a class="nav-link" href="/about/">About</a></li>
            <li class="nav-item"><a class="nav-link" href="/admin/">Admin</a></li>
            <li class="nav-item"><a class="nav-link" href="/help/">Help</a></li>
            <li class="nav-item"><a class="nav-link" href="/list/">List</a></li>
            <li class="nav-item"><a class="nav-link" href="/data/">Data</a></li>
            <li class="nav-item"><a class="nav-link" href="/profile/">Profile</a></li>

          <!-- ================= STAFF ================= -->
          {% elif user|has_group:"Staff" %}
            <li class="nav-item"><a class="nav-link" href="/about/">About</a></li>
            <li class="nav-item"><a class="nav-link" href="/book/">Book</a></li>
            <li class="nav-item"><a class="nav-link" href="/help/">Help</a></li>
            <li class="nav-item"><a class="nav-link" href="/data/">Data</a></li>
            <li class="nav-item"><a class="nav-link" href="/profile/">Profile</a></li>
            <li class="nav-item"><a class="nav-link" href="/staff/">Staff</a></li>

          <!-- ================= USER ================= -->
          {% elif user|has_group:"User" %}
            <li class="nav-item"><a class="nav-link" href="/about/">About</a></li>
            <li class="nav-item"><a class="nav-link" href="/bank/">Bank</a></li>
            <li class="nav-item"><a class="nav-link" href="/help/">Help</a></li>
            <li class="nav-item"><a class="nav-link" href="/list/">List</a></li>
            <li class="nav-item"><a class="nav-link" href="/profile/">Profile</a></li>
            <li class="nav-item"><a class="nav-link" href="/user/">User</a></li>

          {% endif %}

        {% endif %}
      </ul>

      <!-- RIGHT SIDE: PROFILE DROPDOWN / GOOGLE LOGIN -->
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        {% if user.is_authenticated %}
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="profileDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              {% if google_picture %}
                <img src="{{ google_picture }}" class="rounded-circle me-2"
                     style="width:32px; height:32px; object-fit:cover; border:2px solid #fff;">
              {% else %}
                <i class="bi bi-person-circle me-1"></i>
              {% endif %}
              <span class="d-none d-lg-inline">{{ user.get_full_name }}</span>
              <span class="d-lg-none">{{ user.first_name }}</span>
            </a>

            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
              <li><a class="dropdown-item" href="{% url 'profile' %}">Profile</a></li>
              <li><hr class="dropdown-divider"></li>
              <li>
                <form action="{% url 'logout' %}?next={{ request.get_full_path|urlencode }}" method="post" class="px-3 py-1">
                  {% csrf_token %}
                  <button type="submit" class="dropdown-item">Logout</button>
                </form>
              </li>
            </ul>
          </li>
        {% else %}
          <!-- Google login bila user belum login -->
          <li class="nav-item">
            <a class="nav-link" href="{% url 'social:begin' 'google-oauth2' %}?next={{ request.get_full_path|urlencode }}">
              Login with Google
            </a>
          </li>
        {% endif %}
      </ul>

    </div>
  </div>
</nav>